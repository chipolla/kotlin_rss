<!DOCTYPE html>
<!-- saved from url=(0053)http://kotlin.link/Building_a_Kotlin_project_2_2.html -->
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building a Kotlin project 2/2</title>
    <link rel="stylesheet" href="./styles.css">

</head>
<body>
<div id="layout" class="layout">
    <header class="article-nav">
        <button class="menu-link">
            <!-- Hamburger icon -->
            <span></span>
        </button>
        <div class="article-nav-links">
            <a class="article-nav-link article-nav-link--prev">previous</a>
            <a class="article-nav-link article-nav-link--next">next</a>
        </div>
    </header>

    <aside id="menu" class="menu">
        <div class="pure-menu">

            <ul class="pure-menu-list">
                <li><a href="http://kotlin.link/Kotlin_DSL__Anko.html">Kotlin DSL: Anko</a></li>
                <li class="pure-menu-list-date"><a href="http://kotlin.link/Kotlin__Practical_Experience.html">Kotlin: Practical Experience</a></li>
                <li><a href="http://kotlin.link/Exploring_Delegation_in_Kotlin.html">Exploring Delegation in Kotlin</a>
                </li>
                <li><a href="http://kotlin.link/Kotlin%E2%80%99s_killer_features.html">Kotlin’s killer features</a></li>
                <li><a href="http://kotlin.link/Experimental__Kotlin_and_mutation_testing.html">Experimental: Kotlin and
                    mutation testing</a></li>
                <li class="pure-menu-list-date"><a href="http://kotlin.link/10_Features_I_Wish_Java_Would_Steal_From_the_Kotlin_Language.html">10
                    Features I Wish Java Would Steal From the Kotlin Language</a></li>
                <li>
                    <a href="http://kotlin.link/Ubuntu_Make_1603_Released_With_Eclipse_JEE_And_IntelliJ_IDEA_EAP_Support__More.html">Ubuntu
                        Make 16.03 Released With Eclipse JEE And IntelliJ IDEA EAP Support, More</a></li>
                <li><a href="http://kotlin.link/Kotlin%E2%80%99s_Android_Roadmap.html">Kotlin’s Android Roadmap</a></li>
                <li>
                    <a href="http://kotlin.link/%D0%90%D0%BD%D0%B4%D1%80%D0%B5%D0%B9_%D0%91%D1%80%D0%B5%D1%81%D0%BB%D0%B0%D0%B2_%D0%B8_%D0%94%D0%BC%D0%B8%D1%82%D1%80%D0%B8%D0%B9_%D0%96%D0%B5%D0%BC%D0%B5%D1%80%D0%BE%D0%B2_%D0%BE_Kotlin_10_%D0%BD%D0%B0_jugmskru.html">Андрей
                        Бреслав и Дмитрий Жемеров о Kotlin 1.0 на jug.msk.ru</a></li>
                <li><a href="http://kotlin.link/Writing_a_RESTful_backend_using_Kotlin_and_Spring_Boot.html">Writing a
                    RESTful backend using Kotlin and Spring Boot</a></li>
                <li><a href="http://kotlin.link/A_Geospatial_Messenger_with_Kotlin__Spring_Boot_and_PostgreSQL.html">A
                    Geospatial Messenger with Kotlin, Spring Boot and PostgreSQL</a></li>
                <li><a href="http://kotlin.link/Algebraic_Data_Types_In_Kotlin.html">Algebraic Data Types In Kotlin</a>
                </li>
                <li><a href="http://kotlin.link/Kotlin_Month_Post_4__Properties.html">Kotlin Month Post 4:
                    Properties</a></li>
                <li><a href="http://kotlin.link/Kotlin_Educational_Plugin.html">Kotlin Educational Plugin</a></li>
                <li><a href="http://kotlin.link/Kotlin_recipes_for_Android__I___OnGlobalLayoutListener.html">Kotlin
                    recipes for Android (I): OnGlobalLayoutListener</a></li>
                <li><a href="http://kotlin.link/Kotlin_101_is_Here!.html">Kotlin 1.0.1 is Here!</a></li>
                <li><a href="http://kotlin.link/Kotlin___Retrofit___RxAndroid___Realm.html">Kotlin : Retrofit +
                    RxAndroid + Realm</a></li>
                <li><a href="http://kotlin.link/Kotlin_&amp;_Android__A_Brass_Tacks_Experiment_Wrap_Up.html">Kotlin
                    &amp; Android: A Brass Tacks Experiment Wrap-Up</a></li>
                <li><a href="http://kotlin.link/Feedback_on_the_Josephus_problem.html">Feedback on the Josephus
                    problem</a></li>
                <li><a href="http://kotlin.link/Kotlin_Month_Post_3__Safety.html">Kotlin Month Post 3: Safety</a></li>
                <li><a href="http://kotlin.link/Why_I_don_t_want_to_use_Kotlin_for_Android_Development_yet.html">Why I
                    don't want to use Kotlin for Android Development yet</a></li>
                <li>
                    <a href="http://kotlin.link/SDCast__41__%D0%B2_%D0%B3%D0%BE%D1%81%D1%82%D1%8F%D1%85_%D0%90%D0%BD%D0%B4%D1%80%D0%B5%D0%B9_%D0%91%D1%80%D0%B5%D1%81%D0%BB%D0%B0%D0%B2__%D1%80%D1%83%D0%BA%D0%BE%D0%B2%D0%BE%D0%B4%D0%B8%D1%82%D0%B5%D0%BB%D1%8C_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0_Kotlin_%D0%B2_%D0%BA%D0%BE%D0%BC%D0%BF%D0%B0%D0%BD%D0%B8%D0%B8_JetBrains.html">SDCast
                        #41: в гостях Андрей Бреслав, руководитель проекта Kotlin в компании JetBrains</a></li>
                <li><a href="http://kotlin.link/Getting_Started_with_Kotlin_and_Anko_on_Android.html">Getting Started
                    with Kotlin and Anko on Android</a></li>
                <li><a href="http://kotlin.link/A_DSL_Workbench_with_Gradle_and_Kotlin.html">A DSL Workbench with Gradle
                    and Kotlin</a></li>
                <li><a href="http://kotlin.link/Kotlin_&amp;_Android__A_Brass_Tacks_Experiment__Part_6.html">Kotlin
                    &amp; Android: A Brass Tacks Experiment, Part 6</a></li>
                <li><a href="http://kotlin.link/Solving_the_Josephus_problem_in_Kotlin.html">Solving the Josephus
                    problem in Kotlin</a></li>
                <li><a href="http://kotlin.link/Kotlin_Month_Post_2__Inheritance_and_Defaults.html">Kotlin Month Post 2:
                    Inheritance and Defaults</a></li>
                <li><a href="http://kotlin.link/Building_a_Kotlin_project_1_2.html">Building a Kotlin project 1/2</a>
                </li>
                <li>
                    <a href="http://kotlin.link/[RU]_%D0%92%D0%B8%D0%B4%D0%B5%D0%BE_%D1%81%D0%BE_%D0%B2%D1%81%D1%82%D1%80%D0%B5%D1%87%D0%B8_JUGru_%D1%81_%D1%80%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%87%D0%B8%D0%BA%D0%B0%D0%BC%D0%B8_Kotlin.html">[RU]
                        Видео со встречи JUG.ru с разработчиками Kotlin</a></li>
                <li><a href="./Building a Kotlin project 2_2_files/Building a Kotlin project 2_2.html">Building a Kotlin
                    project 2/2</a></li>
                <li><a href="http://kotlin.link/Kotlin__a_new_JVM_language_you_should_try.html">Kotlin: a new JVM
                    language you should try</a></li>
                <li>
                    <a href="http://kotlin.link/Kotlin_%D0%B4%D0%BB%D1%8F_%D0%BD%D0%B0%D1%87%D0%B8%D0%BD%D0%B0%D1%8E%D1%89%D0%B8%D1%85.html">Kotlin
                        для начинающих</a></li>
                <li><a href="http://kotlin.link/Kotlin_&amp;_Android__A_Brass_Tacks_Experiment__Part_5.html">Kotlin
                    &amp; Android: A Brass Tacks Experiment, Part 5</a></li>
                <li><a href="http://kotlin.link/Developing_on_Android_sucks_a_lot_less_with_Kotlin.html">Developing on
                    Android sucks a lot less with Kotlin</a></li>
                <li>
                    <a href="http://kotlin.link/The_Journey_of_a_Spring_Boot_application_from_Java_8_to_Kotlin__part_3__Data_Classes.html">The
                        Journey of a Spring Boot application from Java 8 to Kotlin, part 3: Data Classes</a></li>
                <li>
                    <a href="http://kotlin.link/%D0%9A%D0%B0%D0%BA_%D1%81%D0%B5%D0%B1%D0%B5_%D0%B2%D1%8B%D1%81%D1%82%D1%80%D0%B5%D0%BB%D0%B8%D1%82%D1%8C_%D0%B2_%D0%BD%D0%BE%D0%B3%D1%83_%D0%B2_Kotlin.html">Как
                        себе выстрелить в ногу в Kotlin</a></li>
                <li><a href="http://kotlin.link/Kotlin_and_Ceylon.html">Kotlin and Ceylon</a></li>
                <li><a href="http://kotlin.link/Kotlin_Month_Post_1__Assorted_Features.html">Kotlin Month Post 1:
                    Assorted Features</a></li>
                <li><a href="http://kotlin.link/Kotlin___2_Years_On.html">Kotlin - 2 Years On</a></li>
                <li>
                    <a href="http://kotlin.link/The_Journey_of_a_Spring_Boot_application_from_Java_8_to_Kotlin__part_2__Configuration_Classes.html">The
                        Journey of a Spring Boot application from Java 8 to Kotlin, part 2: Configuration Classes</a>
                </li>
                <li><a href="http://kotlin.link/Kotlin_10_is_finally_released!.html">Kotlin 1.0 is finally released!</a>
                </li>
                <li><a href="http://kotlin.link/An_Introduction_to_Kotlin.html">An Introduction to Kotlin</a></li>
                <li><a href="http://kotlin.link/More_Kotlin_Features_to_Love.html">More Kotlin Features to Love</a></li>
                <li><a href="http://kotlin.link/A_Very_Peculiar__but_Possibly_Cunning_Kotlin_Language_Feature.html">A
                    Very Peculiar, but Possibly Cunning Kotlin Language Feature.</a></li>
                <li>
                    <a href="http://kotlin.link/Kotlin__Easily_storing_a_list_in_SharedPreferences_with_Custom_Accessors.html">Kotlin:
                        Easily storing a list in SharedPreferences with Custom Accessors</a></li>
                <li><a href="http://kotlin.link/Kotlin%E2%80%8A%E2%80%94%E2%80%8ALove_at_first_line.html">Kotlin — Love
                    at first line</a></li>
                <li><a href="http://kotlin.link/Using_Mockito_for_unit_testing_with_Kotlin__1_x_.html">Using Mockito for
                    unit testing with Kotlin (1/x)</a></li>
                <li><a href="http://kotlin.link/[RU]_%D0%9D%D0%B5%D0%BC%D0%BD%D0%BE%D0%B3%D0%BE_%D0%BE_Kotlin.html">[RU]
                    Немного о Kotlin.</a></li>
                <li><a href="http://kotlin.link/The_Kobalt_diaries__testing.html">The Kobalt diaries: testing</a></li>
                <li><a href="http://kotlin.link/[RU]_%D0%A0%D0%B0%D0%B4%D0%B8%D0%BE_%D0%A2_484.html">[RU] Радио-Т
                    484</a></li>
                <li>
                    <a href="http://kotlin.link/[RU]_DevZen_Podcast__Kotlin_%D0%B8_Vulkan_10_%E2%80%94_Episode_0080.html">[RU]
                        DevZen Podcast: Kotlin и Vulkan 1.0 — Episode 0080.</a></li>
                <li>
                    <a href="http://kotlin.link/[RU]_Kotlin_10_%D0%97%D0%B0%D0%B4%D0%B0%D0%B9_%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81_%D0%BA%D0%BE%D0%BC%D0%B0%D0%BD%D0%B4%D0%B5.html">[RU]
                        Kotlin 1.0. Задай вопрос команде.</a></li>
                <li>
                    <a href="http://kotlin.link/[RU]_%D0%A0%D0%B5%D0%BB%D0%B8%D0%B7_Kotlin_10__%D1%8F%D0%B7%D1%8B%D0%BA%D0%B0_%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F_%D0%B4%D0%BB%D1%8F_JVM_%D0%B8_Android.html">[RU]
                        Релиз Kotlin 1.0, языка программирования для JVM и Android.</a></li>
                <li><a href="http://kotlin.link/Kotlin_10__The_good__the_bad_and_the_evident.html">Kotlin 1.0: The good,
                    the bad and the evident.</a></li>
                <li><a href="http://kotlin.link/Kotlin_10_Released__Pragmatic_Language_for_JVM_and_Android.html">Kotlin
                    1.0 Released: Pragmatic Language for JVM and Android</a></li>
                <li><a href="http://kotlin.link/JVM_Newcomer_Kotlin_10_is_GA.html">JVM Newcomer Kotlin 1.0 is GA</a>
                </li>
                <li><a href="http://kotlin.link/Developing_Spring_Boot_applications_with_Kotlin.html">Developing Spring
                    Boot applications with Kotlin.</a></li>
                <li>
                    <a href="http://kotlin.link/The_Journey_of_a_Spring_Boot_application_from_Java_8_to_Kotlin__The_Application_Class.html">The
                        Journey of a Spring Boot application from Java 8 to Kotlin: The Application Class</a></li>
                <li><a href="http://kotlin.link/Kotlin_&amp;_Android__A_Brass_Tacks_Experiment__Part_4.html">Kotlin
                    &amp; Android: A Brass Tacks Experiment, Part 4</a></li>
                <li>
                    <a href="http://kotlin.link/[RU]_Podcast_%D0%A0%D0%B0%D0%B7%D0%B1%D0%BE%D1%80_%D0%9F%D0%BE%D0%BB%D0%B5%D1%82%D0%BE%D0%B2__Episode_102_%E2%80%94_Kotlin__%D1%82%D0%B5%D1%81%D1%82%D1%8B_%D0%B8_%D0%B7%D0%B4%D0%BE%D1%80%D0%BE%D0%B2%D1%8B%D0%B9_%D1%81%D0%BE%D0%BD.html">[RU]
                        Podcast Разбор Полетов: Episode 102 — Kotlin, тесты и здоровый сон.</a></li>
                <li><a href="http://kotlin.link/Kotlin_Coding.html">Kotlin Coding</a></li>
                <li><a href="http://kotlin.link/KillerTask__the_solution_to_AsyncTask_implementation.html">KillerTask,
                    the solution to AsyncTask implementation</a></li>
                <li><a href="http://kotlin.link/My_Kotlin_Adventure.html">My Kotlin Adventure</a></li>
                <li>
                    <a href="http://kotlin.link/Kotlin__the_somewhat_obscure_modern_Android_friendly_programming_language.html">Kotlin,
                        the somewhat obscure modern Android-friendly programming language</a></li>
                <li><a href="http://kotlin.link/Android_development_with_Kotlin.html">Android development with
                    Kotlin</a></li>
                <li><a href="http://kotlin.link/Kotlin_XML_Binding.html">Kotlin XML Binding</a></li>
                <li>
                    <a href="http://kotlin.link/Kotlin_for_Java_Developers__10_Features_You_Will_Love_About_Kotlin.html">Kotlin
                        for Java Developers: 10 Features You Will Love About Kotlin</a></li>
                <li><a href="http://kotlin.link/Setting_up_Kotlin_with_Android_and_tests.html">Setting up Kotlin with
                    Android and tests</a></li>
                <li><a href="http://kotlin.link/Exploring_the_Kotlin_standard_library.html">Exploring the Kotlin
                    standard library</a></li>
                <li><a href="http://kotlin.link/Exploring_Kotlin.html">Exploring Kotlin</a></li>
                <li><a href="http://kotlin.link/RxAndroid_and_Kotlin__Part_1_.html">RxAndroid and Kotlin (Part 1)</a>
                </li>
            </ul>
        </div>
    </aside>

    <section id="main" class="main">

        <section class="main-content">
            <h1><a href="http://cirorizzo.net/2016/03/04/building-a-kotlin-project-2/">Building a Kotlin project 2/2</a>
                - Mar 04, 2016</h1>
            <h2>by Ciro Rizzo</h2>
            <h6><em>Part 2</em></h6>
            <p>In the previous <a href="http://www.cirorizzo.net/building-a-kotlin-project/">post</a> we started a new
                project from scratch, and adjusted the <code>build.gradle</code> for the Kitten App purpose.</p>
            <p>The next steps are going to be the programming of the elements of the app.</p>
            <h4>Data Model</h4>
            <p>One of the main features of the app is to retrieve data through Internet via the <code>http://thecatapi.com/</code>
            </p>
            <blockquote>
                <p><em>The complete API call will be i.e. <code>http://thecatapi.com/api/images/get?format=xml&amp;results_per_page=10</code></em>
                </p>
            </blockquote>
            <p>The API sends back an <code>XML</code> file like this one</p>
            <p><img src="./Building a Kotlin project 2_2_files/xxmlAPI.png.pagespeed.ic.CABTBWB1Ch.png" alt="XML-API">
            </p>
            <p>It needs to deserialize in order to get the <code>url</code> property containing the location of the
                Kitten image.</p>
            <p>Kotlin has a very useful class called <code>data class</code> that is perfect for the purpose.</p>
            <p>Let's starting to create a new class file in the <code>model.cats</code> package using right click on it
                and <code>New-&gt;Kotlin File/Class</code> and call it <code>Cats</code> and choose <code>Class</code>
                as kind.</p>
            <p>In order to structure the class as the <code>XML</code> file received the <code>Cats.kt</code> will be as
                the following</p>
<pre><code class="hljs language-kotlin">data <span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">Cats</span></span>(<span class="hljs-variable"><span
        class="hljs-keyword">var</span> data</span>: Data? = <span class="hljs-literal">null</span>)

    data <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">Data</span></span>(<span class="hljs-variable"><span class="hljs-keyword">var</span> images</span>:
    ArrayList<span class="hljs-type">&lt;Image&gt;</span>? = <span class="hljs-literal">null</span>)

    data <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">Image</span></span>(<span class="hljs-variable"><span class="hljs-keyword">var</span> url</span>:
    String? = <span class="hljs-string">""</span>, <span class="hljs-variable"><span class="hljs-keyword">var</span> id</span>:
    String? = <span class="hljs-string">""</span>, <span class="hljs-variable"><span class="hljs-keyword">var</span> source_url</span>:
    String? = <span class="hljs-string">""</span>)</code></pre>
            <p>So far very simple...
                The same class in Java is much longer!</p>
            <p>The Kotlin Data Class has several benefits, some of them are that the compiler generates
                <code>getter()</code>, <code>setter()</code> and <code>toString()</code> methods, and many more like
                <code>equals()</code> <code>hashCode()</code> and <code>copy()</code>. So it's the perfect class to use
                to deserialize data</p>
            <h4>API Call</h4>
            <p>There are many ways to retrieve data through the network, and different libraries to handle it. One of
                these libraries is the <a href="http://square.github.io/retrofit/">Retrofit2</a> library from Square.
                This is a very powerful <code>HTTPClient</code> and easy to set up.</p>
            <p>Let's start with the <code>interface</code> and create it under the <code>network</code> package.
                Call it <code>CatAPI</code> as shown</p>
<pre><code class="hljs language-kotlin">interface CatAPI {
    @GET(<span class="hljs-string">"/api/images/get?format=xml&amp;results_per_page="</span> +
    BuildConfig.MAX_IMAGES_PER_REQUEST)
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getCatImageURLs</span><span class="hljs-params">()</span>: Observable<span
            class="hljs-type">&lt;Cats&gt;</span></span>
    }</code></pre>
            <p>The <code>interface</code> will manage the <code>Get</code> request to the API Endpoint <code>/api/images/get?format=xml&amp;results_per_page=</code>.
                In this case the param <code>results_per_page</code> retrieve its numerical value from the constant
                defined in the <code>build.gradle</code> called <code>MAX_IMAGES_PER_REQUEST</code> that will have
                different values depending on the <code>buildTypes</code> used.</p>
<pre><code class="hljs language-kotlin">buildTypes {
    debug {
    buildConfigField(<span class="hljs-string">"int"</span>, <span class="hljs-string">"MAX_IMAGES_PER_REQUEST"</span>,
    <span class="hljs-string">"10"</span>)
    ...</code></pre>
            <blockquote>
                <p>This method is very useful to have different value of constants in case we're using
                    <code>debug</code> type or <code>release</code> one i.e. <em>especially in case you need to access
                        to the debug API instead of the production one</em></p>
            </blockquote>
            <p>About the <code>interface CatAPI</code> is very interesting the function called to manage the callback
                from the API <code>fun getCatImageURLs(): Observable&lt;Cats&gt;</code></p>
            <p>So the next step is its implementation.
                Let's create a new class under the same package (<code>network</code>) and call it
                <code>CatAPINetwork</code> as this</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">CatAPINetwork</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getExec</span><span
            class="hljs-params">()</span>: Observable<span class="hljs-type">&lt;Cats&gt;</span> {</span>
    <span class="hljs-variable"><span class="hljs-keyword">val</span> retrofit</span> = Retrofit.Builder()
    .baseUrl(<span class="hljs-string">"http://thecatapi.com"</span>)
    .addConverterFactory(SimpleXmlConverterFactory.create())
    .addCallAdapterFactory(RxJavaCallAdapterFactory.create())
    .build()

    <span class="hljs-variable"><span class="hljs-keyword">val</span> catAPI</span>: CatAPI =
    retrofit.create(CatAPI::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span>

    <span class="hljs-keyword">return</span> catAPI.getCatImageURLs().
    subscribeOn(Schedulers.io()).
    observeOn(AndroidSchedulers.mainThread())
    }
    }</code></pre>
            <p>The <code>fun getExec(): Observable&lt;Cats&gt;</code> is implicitly <code>public</code> so that means
                available to be called by outside this class.</p>
            <p>The line <code>.addConverterFactory(SimpleXmlConverterFactory.create())</code> indicates to use the
                <code>XML</code> converter to deserialize the result form the API call.</p>
            <p>Then the <code>.addCallAdapterFactory(RxJavaCallAdapterFactory.create())</code> is the call adapter to
                use on the API Callback</p>
            <p>The <code>return</code> lines referring to the <code>RxJava</code> <code>Observable</code></p>
<pre><code class="hljs language-kotlin"><span class="hljs-keyword">return</span> catAPI.getCatImageURLs().
    subscribeOn(Schedulers.io()).
    observeOn(AndroidSchedulers.mainThread())</code></pre>
            <h4>Presenter</h4>
            <p>The <code>Presenter</code> modules are in charge of managing the logic of the app and to bind data
                between the <code>View</code> and the <code>Model</code>.</p>
            <p>In our case it will implement the method called by the <code>View</code> to retrieve the API data and
                send them to the <code>Adapter</code> in charge to show up.</p>
            <p>In order to communicate with the <code>View</code> we're starting to create its <code>interface</code>
                called <code>MasterPresenter</code> under the package <code>presenter</code> as the followed</p>
<pre><code class="hljs language-kotlin">interface MasterPresenter {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">connect</span><span
            class="hljs-params">(imagesAdapter: <span class="hljs-type">ImagesAdapter</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getMasterRequest</span><span class="hljs-params">()</span></span>
    }</code></pre>
            <p>The first function <code>fun connect(imagesAdapter: ImagesAdapter)</code> will be used to connect the
                <code>Adapter interface</code> to show data, and the <code>fun getMasterRequest()</code> will be the one
                to start the API request.</p>
            <p>Let's the implementations in a new class under the same <code>presenter</code> package and call it <code>MasterPresenterImpl</code>
            </p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">MasterPresenterImpl</span> : <span class="hljs-type">MasterPresenter {</span></span>
    lateinit <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-keyword">var</span> imagesAdapter</span>:
    ImagesAdapter

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">connect</span><span class="hljs-params">(imagesAdapter: <span class="hljs-type">ImagesAdapter</span>)</span> {</span>
    this.imagesAdapter = imagesAdapter
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getMasterRequest</span><span class="hljs-params">()</span> {</span>
    imagesAdapter.setObservable(getObservableMasterRequest(CatAPINetwork()))
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getObservableMasterRequest</span><span class="hljs-params">(catAPINetwork: <span
            class="hljs-type">CatAPINetwork</span>)</span>: Observable<span
            class="hljs-type">&lt;Cats&gt;</span> {</span>
    <span class="hljs-keyword">return</span> catAPINetwork.getExec()
    }
    }</code></pre>
            <p>Interesting line at <code>lateinit private var imagesAdapter: ImagesAdapter</code> where Kotlin give us
                the chance to declare a Non-Nullable mutable object without initialization thanks to
                <code>lateinit</code> keyword. So it will be initialize at the first time it will be used at runtime; in
                our case on calling the <code>fun connect(imagesAdapter: ImagesAdapter)</code>.</p>
            <p>The function <code>fun getMasterRequest()</code> is in charge of starting the API call, just set the
                <code>Observable</code> in order to be subscribed by the <code>Adapter</code> (i.e.
                <code>imagesAdapter</code>) after starts the <code>catAPINetwork.getExec()</code> that executes the API
                call</p>
            <h4>View section</h4>
            <p>In the <code>view</code> package are collected the classes to manage the UI.
                Basically are the <code>View</code> and the <code>Adapter</code> ones; in our case
                <code>MainActivity</code> and <code>ImagesAdapter</code>.</p>
            <h6>Layouts</h6>
            <p>Before starting with their implementation, let's go through the <code>Layout</code> designing.</p>
            <p><img src="./Building a Kotlin project 2_2_files/xkittenApp-1.png.pagespeed.ic.ulo4yWl6Cg.png"
                    alt="Kitten App"> To design it we need basically of two elements the
                <mark>main container</mark>
                and the
                <mark>item container</mark>
                .
            </p>
            <p>The
                <mark>main container</mark>
                is the element containing the list of the item and we're going to place it in the <code>activity_main.xml</code>
                contained in the <code>res-&gt;layout</code> folder of the project; this one has been automatically
                created during the initial phase of <a href="http://www.cirorizzo.net/building-a-kotlin-project/">Project
                    Creation</a>.
            </p>
            <p>For our app we need to inject in a <code>RecyclerView</code> component (a very powerful and optimized
                component for listing views).</p>
            <p>The <code>activity_main.xml</code> will be like shown</p>
<pre><code class="hljs language-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span
        class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span><span
        class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">RelativeLayout</span> <span
        class="hljs-attr">xmlns:android</span>=<span
        class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">tools:context</span>=<span class="hljs-string">".view.MainActivity"</span>
    <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">android.support.v7.widget.RecyclerView</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/containerRecyclerView"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:scrollbars</span>=<span class="hljs-string">"vertical"</span>
        <span class="hljs-attr">android:layout_centerInParent</span>=<span
                class="hljs-string">"true"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RelativeLayout</span>&gt;</span></code></pre>
            <p>The component <code>containerRecyclerView</code> represents the
                <mark>main container</mark>
                of the list of item
            </p>
            <p>The <code>row_card_view.xml</code> is the
                <mark>item container</mark>
                of our list and basically it appears like this
            </p>
<pre><code class="hljs language-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span
        class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span><span
        class="hljs-meta">?&gt;</span></span>
<span class="hljs-tag">&lt;<span class="hljs-name">android.support.v7.widget.CardView</span>
    <span class="hljs-attr">xmlns:card_view</span>=<span
            class="hljs-string">"http://schemas.android.com/apk/res-auto"</span>
    <span class="hljs-attr">xmlns:android</span>=<span
            class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/card_view"</span>
    <span class="hljs-attr">android:layout_gravity</span>=<span class="hljs-string">"center"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">card_view:cardCornerRadius</span>=<span class="hljs-string">"4dp"</span>
    <span class="hljs-attr">android:layout_margin</span>=<span class="hljs-string">"16dp"</span>
    <span class="hljs-attr">android:background</span>=<span class="hljs-string">"@android:color/transparent"</span>
    <span class="hljs-attr">android:layout_centerInParent</span>=<span class="hljs-string">"true"</span>
    <span class="hljs-attr">android:elevation</span>=<span class="hljs-string">"4dp"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">RelativeLayout</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_centerInParent</span>=<span class="hljs-string">"true"</span>
        <span class="hljs-attr">android:gravity</span>=<span class="hljs-string">"center"</span>
        <span class="hljs-attr">android:foregroundGravity</span>=<span class="hljs-string">"center"</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">ImageView</span>
            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/imgVw_cat"</span>
            <span class="hljs-attr">android:padding</span>=<span class="hljs-string">"4dp"</span>
            <span class="hljs-attr">android:layout_centerInParent</span>=<span class="hljs-string">"true"</span>
            <span class="hljs-attr">android:scaleType</span>=<span class="hljs-string">"fitCenter"</span>
            <span class="hljs-attr">android:contentDescription</span>=<span
                    class="hljs-string">"@string/cat_image"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">RelativeLayout</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span
            class="hljs-name">android.support.v7.widget.CardView</span>&gt;</span></code></pre>
            <p>As you can see the item container is the <code>card_view</code> that basically is composed by a <code>RelativeLayout</code>
                containing an <code>ImageView</code> (<code>imgVw_cat</code>)</p>
            <h6>Adapter</h6>
            <p>Now we've got basic elements of the <code>Layout</code>, so let's move on implementing the <code>MainActivity</code>
                and the <code>Adapter</code>.</p>
            <p>Starting on <code>Adapter</code> the first thing to create is its <code>interface</code> in order to be
                invoked by the previous <code>MasterPresenterImpl</code> so let's create a new file in the
                <code>view</code> package and called it <code>ImagesAdapter</code> and write it down like this</p>
<pre><code class="hljs language-kotlin">interface ImagesAdapter {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setObservable</span><span
            class="hljs-params">(observableCats: <span class="hljs-type">Observable&lt;Cats&gt;</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unsubscribe</span><span
            class="hljs-params">()</span></span>
    }</code></pre>
            <p>The function <code>setObservable(observableCats: Observable&lt;Cats&gt;)</code> is called by <code>MasterPresenterImpl</code>
                to set the <code>Observable</code> and give the <code>Adapter</code> to subscribe to it.</p>
            <p>The <code>unsubscribe()</code> function will be invoked by the <code>MainActivity</code> to unsubscribe
                the <code>Adapter</code> from the <code>Observable</code> when the activity is destroyed.</p>
            <p>Now let's implement them in a new class under the same package called <code>ImagesAdapterImpl</code> that
                appears like that</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">ImagesAdapterImpl</span> : <span class="hljs-type">RecyclerView.Adapter</span>&lt;<span
        class="hljs-type">ImagesAdapterImpl.ImagesURLsDataHolder</span>&gt;</span>(), ImagesAdapter {
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span
            class="hljs-keyword">val</span> TAG</span> = ImagesAdapterImpl::<span class="hljs-class"><span
            class="hljs-keyword">class</span>.<span class="hljs-title">java</span>.<span
            class="hljs-title">simpleName</span></span>

    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span
            class="hljs-keyword">var</span> cats</span>: Cats? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> subscriber</span>:
    Subscriber<span class="hljs-type">&lt;Cats&gt;</span> by lazy { getSubscribe() }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(parent: <span class="hljs-type">ViewGroup, viewType: Int</span>)</span>: ImagesURLsDataHolder {</span>
    <span class="hljs-keyword">return</span> ImagesURLsDataHolder(
    LayoutInflater.from(parent.context).inflate(R.layout.row_card_view, parent, <span class="hljs-literal">false</span>))
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getItemCount</span><span class="hljs-params">()</span>: <span
            class="hljs-keyword">Int</span> {</span>
    <span class="hljs-keyword">return</span> cats?.data?.images?.size ?: <span class="hljs-number">0</span>
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">ImagesURLsDataHolder, position: Int</span>)</span> {</span>
    holder.bindImages(cats?.data?.images?.<span class="hljs-keyword">get</span>(position)?.url ?: <span
            class="hljs-string">""</span>)
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">setData</span><span class="hljs-params">(cats: <span
            class="hljs-type">Cats?</span>)</span> {</span>
    this.cats = cats
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">setObservable</span><span class="hljs-params">(observableCats: <span class="hljs-type">Observable&lt;Cats&gt;</span>)</span> {</span>
    observableCats.subscribe(subscriber)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">unsubscribe</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">if</span> (!subscriber.isUnsubscribed) {
    subscriber.unsubscribe()
    }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getSubscribe</span><span class="hljs-params">()</span>: Subscriber<span
            class="hljs-type">&lt;Cats&gt;</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span> : Subscriber<span
            class="hljs-type">&lt;Cats&gt;</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onCompleted</span><span class="hljs-params">()</span> {</span>
    Log.d(TAG, <span class="hljs-string">"onCompleted"</span>)
    notifyDataSetChanged()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onNext</span><span class="hljs-params">(cats: <span class="hljs-type">Cats</span>)</span> {</span>
    Log.d(TAG, <span class="hljs-string">"onNextNew"</span>)
    setData(cats)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onError</span><span class="hljs-params">(e: <span
            class="hljs-type">Throwable</span>)</span> {</span>
    <span class="hljs-comment">//TODO : Handle error here</span>
    Log.d(TAG, <span class="hljs-string">""</span> + e.message)
    }
    }
    }

    <span class="hljs-class"><span class="hljs-keyword">class</span> <span
            class="hljs-title">ImagesURLsDataHolder</span></span>(view: View) : RecyclerView.ViewHolder(view) {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bindImages</span><span
            class="hljs-params">(imgURL: <span class="hljs-type">String</span>)</span> {</span>
    Glide.with(itemView.context).
    load(imgURL).
    placeholder(R.mipmap.document_image_cancel).
    diskCacheStrategy(DiskCacheStrategy.ALL).
    centerCrop().
    into(itemView.imgVw_cat)
    }
    }
    }</code></pre>
            <p>This is the class inflate the <code>row_card_view.xml</code>, basically the
                <mark>item container</mark>
                as you can see at function <code>onCreateViewHolder</code></p>
            <p>The function <code>getSubscribe()</code> provide to subscribe the <code>Adapter</code> to the <code>Observable</code>
                used at line <code>private val subscriber: Subscriber&lt;Cats&gt; by lazy { getSubscribe() }</code>
                where you can notice the <code>lazy</code> initialization, this is a way to declare an unmutable object
                (i.e. <code>subscriber</code>) and it'll be created through the function enclosed in the braces (i.e.
                <code>getSubscribe()</code>) at the first invocation at runtime.</p>
            <blockquote>
                <p><em>The Subscriber and Observable concepts comes from <a href="https://github.com/ReactiveX/RxJava">RxJava</a>;
                    We can dig deeper in some next posts</em></p>
            </blockquote>
            <p>At the end, a very interesting piece of code is the inner class called <code>ImagesURLsDataHolder</code>
                used to fill up the <code>imgVw_cat</code> using the <code>Glide</code> library, that helps to retrieve
                the image from the passed <code>URL</code> extracted by the API call. This part is wrapped in the
                function <code>bindImages(imgURL: String)</code> and invoked by the method <code>onBindViewHolder</code>
                in the same file.</p>
            <h6>Activity</h6>
            <p>Last but not least the the <code>Activity</code> (i.e. <code>MainActivity</code>)</p>
<pre><code class="hljs language-kotlin"><span class="hljs-class"><span class="hljs-keyword">class</span> <span
        class="hljs-title">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span></span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> imagesAdapterImpl</span>:
    ImagesAdapterImpl by lazy { ImagesAdapterImpl() }

    <span class="hljs-keyword">private</span> <span class="hljs-variable"><span class="hljs-keyword">val</span> masterPresenterImpl</span>:
    MasterPresenterImpl
    by lazy {
    MasterPresenterImpl()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle?</span>)</span> {</span>
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_main)

    initRecyclerView()
    connectingToMasterPresenter()
    getURLs()
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">onDestroy</span><span class="hljs-params">()</span> {</span>
    imagesAdapterImpl.unsubscribe()
    super.onDestroy()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">initRecyclerView</span><span class="hljs-params">()</span> {</span>
    containerRecyclerView.layoutManager = GridLayoutManager(this, <span class="hljs-number">1</span>)
    containerRecyclerView.adapter = imagesAdapterImpl
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">connectingToMasterPresenter</span><span class="hljs-params">()</span> {</span>
    masterPresenterImpl.connect(imagesAdapterImpl)
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span
            class="hljs-title">getURLs</span><span class="hljs-params">()</span> {</span>
    masterPresenterImpl.getMasterRequest()
    }
    }</code></pre>
            <p>Notice the functions</p>
            <ul>
                <li><code>initRecyclerView()</code></li>
                <li><code>connectingToMasterPresenter()</code></li>
                <li><code>getURLs()</code></li>
            </ul>
            <p>Respectively used to</p>
            <ul>
                <li>initialize the
                    <mark>main container</mark>
                    (i.e. <code>RecyclerView</code>)
                </li>
                <li>connecting the <code>MainActivity</code> to the <code>MasterPresenterImpl</code> and pass to it the
                    <code>interface</code> of the <code>ImagesAdapterImpl</code> (aka <code>Adapter</code>)
                </li>
                <li><code>getURLs()</code> starts the API request to retrieve the <code>XML</code> data, and so
                    executing the followed tasks (deserialize data, retrieving images through <code>Adapter</code>).
                </li>
            </ul>
            <p>The Kitten App is now ready to run.
                In any case you can find the entire project on my Github Repository of the <a
                        href="https://github.com/cirorizzo/KShows">KShow</a> project.
                The same project has been written in Java as well <a
                        href="https://github.com/cirorizzo/JShows">JShows</a> so you can comparing them</p>
            <h6><em>Translations</em></h6>
            <p>This post is also available in Chinese on <a href="https://goo.gl/3YpGoR">gold.xitu.io</a>
                A special thanks for the translation to the <strong>gold.xitu.io</strong> Team</p>

        </section>
    </section>
</div>
<link rel="stylesheet" href="./Building a Kotlin project 2_2_files/default.min.css">
<script src="./Building a Kotlin project 2_2_files/highlight.min.js"></script>

<script>
    var menuLink = document.querySelector('.menu-link');

    var Something = function(element) {
        this.class = 'active';
        this.layout = document.getElementById('layout');
        this.handleEvent = function() {
            this.layout.classList.toggle(this.class);
        };
        this.handleEvent();
    };

    menuLink.addEventListener("click", function(){
        Something(this);
    }, false);
</script>
</body>
</html>